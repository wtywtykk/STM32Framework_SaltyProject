#pragma once

#include "HAL\PeripheralBus.h"

C_HEADER_BEGIN

#define AD8363_Base PeripheralBus_GPIO4Base

#define AD8363_Offset_ChA (PeripheralBus_GPIO4Base+0)
#define AD8363_Offset_ChB (PeripheralBus_GPIO4Base+1)
#define AD8363_Offset_Status (PeripheralBus_GPIO4Base+2)
#define AD8363_Offset_ID (PeripheralBus_GPIO4Base+3)
#define AD8363_Offset_Send (PeripheralBus_GPIO4Base+0)
#define AD8363_Offset_Config (PeripheralBus_GPIO4Base+4)

#define AD8363_IDValue 0x8363

#define AD8363_StatusBit_Ready (1<<0)

#define AD8363_ConfigBit_Reset (1<<0)

#define AD8363_CHANNEL_SHIFT (14)
#define AD8363_CHANNEL_MASK (0x0003<<AD8363_CHANNEL_SHIFT)

#define AD8363_PSEUDO_DIFFERENTIAL_SHIFT (6)
#define AD8363_PSEUDO_DIFFERENTIAL_MASK (0x0001<<AD8363_PSEUDO_DIFFERENTIAL_SHIFT)

#define AD8363_REGACCESS_CONFIG 0x0
#define AD8363_REGACCESS_READCONFIG 0x1
#define AD8363_REGACCESS_REFDAC1 0x2
#define AD8363_REGACCESS_READREFDAC1 0x3
#define AD8363_REGACCESS_SOFTRESET 0x4
#define AD8363_REGACCESS_REFDAC2 0x5
#define AD8363_REGACCESS_READREFDAC2 0x6
#define AD8363_REGACCESS_SEQFIFO 0x9
#define AD8363_REGACCESS_READSEQFIFO 0xB
#define AD8363_REGACCESS_REFCM 0xC
#define AD8363_REGACCESS_READREFCM 0xE

#define AD8363_REGACCESS_SHIFT (0)
#define AD8363_REGACCESS_MASK (0x000F<<AD8363_CHANNEL_SHIFT)

#define AD8363_REFDACPOWERDOWN_SHIFT (10)
#define AD8363_REFDACPOWERDOWN_MASK (0x0001<<AD8363_REFDACPOWERDOWN_SHIFT)

#define AD8363_REFDACVALUE_SHIFT (0)
#define AD8363_REFDACVALUE_MASK (0x03FF<<AD8363_REFDACVALUE_SHIFT)

STATUS ADS8363_Init(void);
bool ADS8363_IsReady(void);
STATUS ADS8363_WaitReady(void);
STATUS ADS8363_GetResult(s16* ChA, s16* ChB);
STATUS ADS8363_SetChannel(u8 Index);
STATUS ADS8363_SetPseudoDifferential(bool PseudoDiff);
STATUS ADS8363_SetREFDAC1(bool PowerDown, float Value);
STATUS ADS8363_SetREFDAC2(bool PowerDown, float Value);
STATUS ADS8363_SetREFCM(u16 Val);

C_HEADER_END
